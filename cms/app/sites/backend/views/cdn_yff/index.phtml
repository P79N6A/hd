<?php
$this->partial("partials/breadcrumb", [
    'urls' => ['CDN分发日志' => Url::get('cdn_yff/index')],
    'cdnlogsearch'=>TRUE,
]);
?>

<?php $this->partial('partials/error_messages');?>
<form method="post" action="" name="myform">
<div class="table-info table-responsive sortable ui-sortable" id="sorttable">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <!--<th class="table-checkbox">选择</th>-->
                <th>中心ID</th>
                <!--<th>来源主ID</th>-->
                <th>标题</th>
                <th>分发CDN</th>
                <th>操作&状态</th>
                <!--<th>任务来源</th>-->
                <th>开始时间</th>
                <th>结束时间</th>
                <th>最后操作</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <?php 
            if (isset($data->models) && !empty($models = $data->models)) {
                
                foreach ($models as $v) {
            ?>
                    <tr>
                        <!--<td class="checkbox-middle">
                            <input type="checkbox" class="checkboxes" value="<?= $v->id ?>" name="" id="main_id" />
                        </td>-->
                        <td>
                            <?= $v->id ?>
                        </td>
                        <!--<td><?= $v->task_id ?></td>-->
                        <td><?= $v->title ?></td>
                        <td><?= $pro_list[$v->cdn_id] ?></td>
                        <td><?= $operation_list[$v->operation] ?>：<span class="font-<?php switch ($v->status){
                            case 1:echo 'blue';break;
                            case 2:echo 'yellow';break;
                            case 3:echo 'green';break;
                            case 4:echo 'red';break; } ?>"><?= $task_status_list[$v->status] ?></span></td>
                        <!--<td><?= $sys_cdn_user_list[$v->task_user_id] ?></td>-->
                        <td><?php if($v->create_time){echo date('Y-m-d H:i:s',$v->create_time);}else{echo '--';} ?></td>
                        <td><?php if($v->end_time){echo date('Y-m-d H:i:s',$v->end_time);}else{echo '--';} ?></td>
                        <td><?= $v->admin_user_name ?>(<?php if($v->update_time){echo date('Y-m-d H:i:s',$v->update_time);}else{echo '--';} ?>)</td>
                        <td>
                            <div class="btn-group btn-group-xs btn-group-solid">
                                <!--
                                <button type="button" class="btn blue edit-content tooltips" 
                                        data-url="<?= Url::get('cdn_yff/priority', ['id' => 1]) ?>" 
                                        data-container="body" 
                                        data-placement="top" 
                                        data-trigger="hover" 
                                        data-html="true"
                                        data-original-title="优先级" ><i class="fa fa-bar-chart-o"></i></button>
                                -->        
                                <button type="button" class="btn green edit-content tooltips" 
                                        data-url="<?= Url::get('cdn_yff/view', ['id' => $v->id]) ?>" 
                                        data-container="body" 
                                        data-placement="top" 
                                        data-trigger="hover" 
                                        data-html="true" 
                                        data-original-title="详情"><i class="fa fa-eye"></i>
                                </button>
                                
                                <?php if($v->status !=3 && $v->status !=1){?>        
                                <button type="button" class="btn tooltips blue"
                                    data-url="<?= Url::get('cdn_yff/resend', ['id' => $v->id,'type'=>1]); ?>"
                                    data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                    data-original-title="重发" onclick="show_confirm(this)">
                                    <i class="fa fa-mail-forward"></i>
                                </button>
                                <?php }?>  
                                
                                <?php if($v->status ==3 && $v->cdn_id !=2){?>        
                                <button type="button" class="btn tooltips yellow"
                                    data-url="<?= Url::get('cdn_yff/resend', ['id' => $v->id,'type'=>2]); ?>"
                                    data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                    data-original-title="强制下架" onclick="show_confirm(this)">
                                    <i class="fa fa-times-circle"></i>
                                </button>
                                <?php }?>
                                <?php if($v->status ==4){?>  
                                <button type="button" class="btn tooltips red"
                                    data-url="<?= Url::get('cdn_yff/deltask', ['id' => $v->id]); ?>"
                                    data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                    data-original-title="隐藏" onclick="show_confirm(this)">
                                    <i class="fa fa-ban"></i>
                                </button>
                                <?php }?>
                            </div>
                        </td>
                    </tr>
                <?php }} ?>   
        </tbody>
    </table>

    <div class="paginationnav">
        <div class="paginationnav-main">
             <div class="table-btn">
                 <!--
                <div class="btn-group">
                    <button type="button" class="btn btn-default group-checkable" data-set="#sorttable .checkboxes">全选</button>
                    <button type="button" class="btn btn-default group-offcheckable" data-set="#sorttable .checkboxes">取消</button>
                    <button type="button" class="btn btn-default group-anticheckable" data-set="#sorttable .checkboxes">反选</button>
                    <button type="submit" class="btn btn-default" name="submit">生成js</button>
                </div>-->
            </div>
            <?= $data->pagination->render();?>
            <div class="pagination-info"><?= Lang::_('total') . "： " . $data->count ?></div>
        </div>
    </div>
</div>
</form>
<script type="text/javascript">

    $("#sorttable .table").tablesorter({
        headers:{
            0:{sorter:false},
            4:{sorter:false},
            6:{sorter:false}
        }
    });
</script>
