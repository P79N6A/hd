<?php
$this->partial("partials/breadcrumb", [
    'urls' => ['活动列表' => Url::get('activity/index')],
    'add'=> '',
    'html' => '',
    'listsignupsearch' => true,
]);
?>

<div class="table-info table-responsive sortable ui-sortable" id="sorttable">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th class="table-checkbox">选择</th>
                <?php foreach($extfields as $field): ?>
                    <th><?= $field['field_text'] ?></th>
                <?php endforeach; ?>
                <th>编号</th>
                <th>手机号</th>
                <th>姓名</th>
                <th>性别</th>
                <th>额外重要字段</th>
                <th>年龄</th>
                <th>报名时间</th>
                <th>权重</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach ($data->models as $model) :
            ?>
            <tr>
                <td class="checkbox-middle">
                    <input type="checkbox" class="checkboxes" name="id" value="<?php //echo $model->activity->id; ?>"/>
                </td>
                <?php
                $extfieldvalue = json_decode($model->ext_values,true);
                foreach($extfields as $field): ?>
                    <td><?= $extfieldvalue[$field['field_name']] ?></td>
                <?php endforeach; ?>
                <td><?= $model->id?:'' ?></td>
                <td><?= $model->mobile?:'' ?></td>
                <td><?= $model->name?:'' ?></td>
                <td><?= $model->user_id==1?'男':($model->user_id==2?'女':'') ?></td>
                <td><?= $model->user_name?:'' ?></td>
                <td><?= $model->ext_field2?:'' ?></td>
                <td><?= date('Y-m-d H:i:s',$model->create_at) ?></td>
                <td><input signup_id="<?= $model->id?:'' ?>" value="<?= $model->index ?>" onchange="changeSort(this)"></td>
                <td>
                    <?php
                        switch(intval($model->status))
                        {
                            case -1: echo 'cdn url nothing';break;
                            case 0: echo '未处理';break;
                            case 1: echo '已审核';break;
                            case 2: echo '未通过';break;
                            case 3: echo '被删除';break;
                            case 4: echo 'ALL'; break;
                        }
                    ?>
                </td>
                <td>
                    <div class="btn-group btn-group-xs btn-group-solid">
                        <button type="button" class="btn green edit-content tooltips" data-url="/activity/auditSignup/?id=<?php echo $model->id; ?>" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="审核"><i class="fa fa-eye"></i></button>
                        <a type="button" class="btn blue tooltips" href="/activity/getWordfile?activity=blinddata&id=<?php echo $model->id; ?>" data-toggle="modal" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="导出资料(交友大会)"><i class="fa fa-file-word-o"></i></a>
                        <a type="button" class="btn yellow tooltips" href="/activity/getWordfile?activity=questionnaire&id=<?php echo $model->id; ?>" data-toggle="modal" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="导出资料(调查问卷)"><i class="fa fa-file-word-o"></i></a>
                    </div>
                </td>
            </tr>
        <?php endforeach;?>
        <?php if(count($data->models) == 0) { ?>
            <tr class="sortable-tr"><td colspan="8">未能找到相关数据</td></tr>
        <?php } ?>
        </tbody>
    </table>

    <div class="paginationnav">
        <div class="paginationnav-main">
            <div class="table-btn">
                <div class="btn-group">
                    <button type="button" class="btn btn-default group-checkable" data-set="#sorttable .checkboxes">全选</button>
                    <button type="button" class="btn btn-default group-offcheckable" data-set="#sorttable .checkboxes">取消</button>
                    <button type="button" class="btn btn-default group-anticheckable" data-set="#sorttable .checkboxes">反选</button>
                    <button type="button" class="btn btn-default" href="#delet-config" data-toggle="modal">删除</button>
                </div>
            </div>

            <?= $data->pagination->render(); ?>
            <div class="pagination-info"><?= Lang::_('total') . "： " . $data->count ?></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $("#sorttable .table").tablesorter({
        headers:{
            0:{sorter:false},
            9:{sorter:false}
        }
    });

    function changeSort(event){
        var sort = parseInt($(event).val());
        $(event).val(sort);
        var sign_id = $(event).attr("signup_id");
        $.ajax({
            type : "post",
            url : "/activity/auditSignup",
            data : { "index" : sort, "id" : sign_id },
            success : function(){
                alert('修改成功');
            }
        })
    }


</script>