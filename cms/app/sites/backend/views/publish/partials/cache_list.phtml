<tbody id="sortbody" style="border-top: none">
<?php
if(!empty($data)) {
    foreach($data->models as $row) {
        $data_data      = $row['data'];
        $category_data  = $row['cat_data'];
        $data_id        = $data_data['id'];
        $source_id      = $data_data['source_id'];
        $status         = $data_data['status'];
        ?>
        <tr class="list_item" draggable="false" category_id="<?=$category_id ?>" listtype="column"
            cat_data_id="<?=$category_data['id']?>" id="<?= $data_id ?>" rel="<?=$category_data['sort']?>" is_special="0">
            <td class="checkbox-middle sortr-handle">
                <input type="checkbox" class="checkboxes" value="<?= $data_id ?>"/>
            </td>
            <td>
                <img class="small-img2" style="width: 56px; height: 35px; opacity: 1;" src="<?= $data_data['thumb']? (stripos($data_data['thumb'],'image.xianghunet.com')?$data_data['thumb']:cdn_url('image',$data_data['thumb'])): '' ?> "/>
                <span class="name-center">
                    <?php
                    $type = $data_data['type'];
                    switch($type) {
                        case 'news':
                            $url = Url::get('publish/edit',['id'=>$data_id, 'type'=>'news']);break;
                        case 'album':
                            $url = Url::get('media_albums/edit',['id'=>$source_id]); break;
                        case 'live':
                            $url = Url::get('publish/edit',['id'=>$data_id, 'type'=>'live']); break;
                        case 'video':
                            $url = Url::get('media_videos/edit',['id'=>$source_id]);break;
                        case 'special':
                            $url = Url::get('media_posts/edit',['id'=>$source_id]);break;
                        default:
                            $url = Url::get('media_posts/edit',['id'=>$source_id]);
                    }
                    ?>
                    <a href="javascript:void(0);" class="name-center ellipsis tooltips quick-sidebar-toggler" data-url="<?= $url ?>"
                       data-original-title=" <?= $data_data['title']; ?>" data-trigger="hover"> <?= $data_data['title']; ?></a>
                    <?php
                    switch($data_data['type']){
                        case 'video':$type_icon = 'fa-play-circle-o';$type_name='视频';break;
                        case 'album':$type_icon = 'fa-photo';$type_name='图集';break;
                        case 'news':$type_icon = 'fa-newspaper-o';$type_name='新闻';break;
                        case 'special':$type_icon = 'fa-sitemap';$type_name='专题';break;
                        case 'live':$type_icon = 'fa-video-camera';$type_name='直播';break;
                        case 'timelimit':$type_icon = 'fa-clock-o';$type_name='时限';break;
                        default: $type_icon = 'fa-newspaper-o';$type_name='其他';break;
                    }
                    ?>
                    <i class="fa <?=$type_icon?> font-yellow-crusta tooltips" style="float: right;margin-top: 11px;"
                       data-original-title="<?=$type_name?>" data-trigger="hover"></i>
                </span>
            </td>
            <td>
                <?php
                    $status_name = array(1=>"已发布","9"=>"待审核","0"=>"撤销");
                    $this->partial('partials/widget/dialogmodal',["type"=>$data_data['type'],"status"=>$status,"data_id"=>$data_id,"status_name"=>$status_name[$status]]);
                ?>


            </td>
            <td><h5 style="margin: 0px">
                    <?=$data_data['author_name']?>
                    <p style="color:#c3c3c3;margin: 0px"><?= date('m/d H:i', $data_data['created_at']) ?></p></h5>
            </td>
            <td>
                <div class="btn-group btn-group-xs btn-group-solid">
<!--                    条目审核-->
                    <?php if($checkAuth('publish/approve')): ?>
                        <button type="button" class="btn tooltips <?= $status == 9 ? 'blue': 'red' ?>"
                                data-url="<?= Url::get('publish/approve', ['id' => $data_id]); ?>"
                                data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                data-original-title="<?= $status == 9 ? '审查': '取消审查' ?>" onclick="show_confirm(this)"><i
                                class="fa  <?= $status == 9 ? 'fa-check': 'fa-ban' ?>"></i></button>
                    <?php endif; ?>
<!--                 条目推到推荐位-->
                    <?php if($checkAuth('publish/features') && !$show_spec): ?>
                    <button type="button" class="btn tooltips green"
                            data-url="<?= Url::get('publish/features', ['category_id' => $category_data['category_id'],'data_id'=>$data_id,'title'=>$data_data['title']]); ?>"
                            data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                            data-original-title="保存到推荐位" onclick="show_confirm(this)"><i
                            class="fa fa-thumbs-up"></i></button>
                    <?php endif; ?>


<!--                模板文件-->
                    <?php if($checkAuth('tpl/topic')): ?>
                    <button type="button" class="btn blue edit-content tooltips"
                            data-url="<?= Url::get('tpl/topic', ['id' => $data_id]) ?>"
                            data-trigger="hover" data-html="true"
                            data-original-title="配置模板"><i class="fa fa-cogs"></i></button>
                    </button>
                    <?php endif; ?>



                    <!--                    发布栏目-->
                    <?php if($checkAuth('media_posts/publish')){ ?>
                        <button type="button" class="btn green-jungle edit-content tooltips"
                                data-url="<?= Url::get('media_posts/publish', ['id' => $data_id]); ?>"
                                data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                data-original-title="<?= $status == 1 ? '修改发布栏目': ($status == 9 ? '修改发布栏目' : '发布') ?>">
                            <i class="fa <?= $status == 1 ? 'fa-pencil': ($status == 9 ? 'fa-pencil' : 'fa-send') ?>"></i></button>
                    <?php }?>



<!--                复制条目至专题-->
                    <?php
                    $special_source_id = $data_data['special_id'];
                    if($data_data['type'] == 'news' && $special_source_id == 0):
                        ?>
                        <?php if($checkAuth('publish/copytospecial')): ?>
                        <button type="button" class="btn yellow-gold tooltips" onclick="show_confirm(this)"
                                data-url="<?= Url::get('publish/copytospecial',['data_id'=>$data_id,'category_id'=>$cid]) ?>"
                                data-toggle="modal" data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                data-original-title="复制当前发布专题"><i class="fa fa-database"></i></button>
                        <?php endif; ?>
                    <?php endif; ?>
<!--                 专题列表-->
                    <?php
                    if(($data_data['type'] == 'news' && $special_source_id > 0)):
                        ?>
                        <?php if($checkAuth('special_category/index')): ?>
                        <button type="button" class="btn purple-plum edit-content tooltips href-location"
                                data-url="<?= Url::get('special_category/index', ['id'=>$special_source_id,"category_id"=>$cid,"publish"=>1]) ?>"
                                data-trigger="hover" data-html="true"
                                data-original-title="专题栏目"><i class="fa  fa-file-archive-o"></i></button>
                        <?php endif; ?>
                    <?php endif; ?>

                    <!--                   接口管理-->
                    <?php if($checkAuth('publish/interface')){ ?>
                        <button type="button" class="btn purple-plum tooltips quick-sidebar-toggler"
                                data-url="<?= Url::get('publish/interface', ['data_id' => $data_id]); ?>"
                                data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                data-original-title="文档接口">
                            <i class="fa fa-link"></i>
                        </button>
                    <?php }?>

<!--                    评论列表-->
                    <?php if($checkAuth('comment_hudong/index')): ?>
                        <button type="button" class="btn blue-madison tooltips href-location"
                                data-url="<?= Url::get('comment_hudong/index', ['data_id'=>$data_id]) ?>"
                                data-trigger="hover" data-html="true"
                                data-original-title="评论列表"><i class="fa fa-comment"></i></button>
                    <?php endif; ?>

<!--                    投票-->
                    <?php if($checkAuth('vote/vote')){ ?>
                            <button data-trigger="hover" data-url="<?= Url::get('vote/vote', ['id' => $data_id]); ?>" 
                                    class="btn bg-yellow-saffron tooltips quick-sidebar-toggler" data-target="#full-width" data-original-title="添加投票"><i
                                    class="fa fa-hand-o-up"></i></button>
                    <?php }?>
<!--                    投票列表-->
                    <?php if($checkAuth('vote/votedetail')): ?>
                            <button data-trigger="hover" data-url="<?= Url::get('vote/votedetail', ['id' => $data_id]); ?>"
                                    class="btn bg-yellow-saffron tooltips quick-sidebar-toggler" data-target="#full-width"
                                    data-original-title="查看投票"><i class="fa fa-hacker-news"></i></button>
                    <?php endif; ?>

                    <!--摇奖-->
                    <?php $vote_data = Data::getDataDataIdByType($data_data["data_data"],'lottery')?>
                    <?php if($checkAuth('lottery_group/add') && empty($vote_data) ){ ?>
                        <button data-trigger="hover" data-url="<?= Url::get('lottery_group/add', ['id' => $data_id]); ?>"
                                class="btn blue-steel tooltips quick-sidebar-toggler" data-target="#full-width"
                                data-original-title="添加摇奖"><i class="fa fa-gift"></i></button>
                    <?php }?>
                    <!--摇奖编辑、删除-->
                    <?php if($checkAuth('lottery_group/edit') && !empty($vote_data) ): ?>
                        <button data-trigger="hover" data-url="<?= Url::get('lottery_group/edit', ['id' => $data_id ,'data_id' => $vote_data[0]]); ?>"
                                class="btn green-jungle tooltips quick-sidebar-toggler" data-target="#full-width"
                                data-original-title="修改摇奖"><i class="fa fa-gift"></i></button>
                    <?php endif; ?>

                    <?php if($checkAuth('features/binding')){ ?>
                        <button type="button" class="btn blue edit-content tooltips"
                                data-url="<?= Url::get('features/binding', ['id' => $data_id]); ?>"
                                data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                data-original-title="绑定推荐位"><i class="fa fa-recycle"></i></button>
                    <?php }?>
                </div>
            </td>
        </tr>
        <?php
    }
}  ?>
</tbody>


