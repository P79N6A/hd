<?php
$timeChecked = false;
if(isset($model->timelimit_begin) && $model->timelimit_begin>0){
    $timeChecked = true;
}
?>
<div class="form-group box-border-right box-border-top box-border-left">
    <label class="control-label col-md-12 time-title">
        <div class="col-md-4 time-builder-div"><h6 class="h6">创建人:</h6><span class="time-builder"><?= $author ?></span></div>
        <div class="input-group date form_datetime validate-box col-md-5" style="margin-top: 2px">
            <input type="text" name="created_at" value="" size="18" class="form-control time-input" id="date_set"
                   readonly>
            <span class="input-group-btn time-hidden-span">
                  <button class="btn default date-set" type="button" style="display: none"><i
                              class="fa fa-calendar"></i></button>
                </span>
        </div>
        <div class="col-md-3 checkbox_btn">
            <input id="toggle-time" type="checkbox" data-toggle="toggle" data-width="55" data-height="25"
                   data-size="mini" data-on="时效" data-off="时效"  <?= $timeChecked? "checked":""?> >
            <input id="limittime_choose" name = "limittime_choose"  value="<?= $timeChecked ? 0: 1?>" hidden>
        </div>
        <script type="text/javascript">
            // 时效开关状态
                $('#toggle-time').bootstrapToggle({
                    on: '时效',
                    off: '时效'
                });

                $('#toggle-time').change(function () {
                    var state = $(this).prop('checked');
                    if (state == true) {
                        $(".time_model").show();
                        $('#limittime_choose').attr("value",0);
                    } else if (state == false) {
                        $(".time_model").hide();
                        $('#limittime_choose').attr("value",1);
                    }
                });
                $(document).ready(function(){
                	var state1 = $('#toggle-time').prop('checked');
                    if (state1 == true) {
                        $(".time_model").show();
                        $('#limittime_choose').attr("value",0);
                    } else if (state1 == false) {
                        $(".time_model").hide();
                        $('#limittime_choose').attr("value",1);
                    }
                });
        </script>
    </label>


    <div class="time_model col-md-12" style="display: none;padding: 0px;">

        <div class="col-md-12 radio-list" id="set_time" style="padding-left: 0px;margin-bottom: 10px">
            <div class="col-md-4" style="margin-top: 12px">开始时间</div>
            <div class="col-md-8">
                <div class="input-group date form_datetime" style="width: 100%;margin-top: 5px">
                    <input type="text" size="18" readonly class="form-control" name="timelimit_begin"
                           style="cursor: pointer;height:30px" id="time_beign"
                           value="<?= isset($model->timelimit_begin) && $model->timelimit_begin > 0 ? date("Y-m-d H:i",$model->timelimit_begin) : date("Y-m-d H:i",time()) ?>"
                    >
                    <span class="input-group-btn">
                                   <button class="btn default date-set" type="button" name="end_time"
                                           style="display: none"></button>
                               </span>
                </div>
            </div>
            <div class="col-md-4" style="margin-top: 12px">结束时间</div>
            <div class="col-md-8">
                <div class="input-group date form_datetime" style="width: 100%;margin-top: 5px">
                    <input type="text" size="18" readonly class="form-control" style="cursor: pointer;height:30px"
                           name="timelimit_end" id="time_end"
                           value="<?= isset($model->timelimit_end) && $model->timelimit_end > 0 ? date("Y-m-d H:i",$model->timelimit_end) : "" ?>"
                    >
                    <span class="input-group-btn">
                                <button class="btn default date-set" type="button" style="display: none"></button>
                            </span>
                </div>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
    /*切换按钮样式*/
    .h6 {
        font-weight: 800;
        display: inline;
        font-size: 15px;
    }

    .checkbox_btn, .comment_control {
        position: absolute;
        right: -33px;
        top: 3px;
        z-index: 9;
        width: 108px;
    }

    .bootstrap-switch.bootstrap-switch-small {
        min-width: 70px;
    }

    /*切换按钮样式end*/
</style>
<script type="text/javascript">
    var validate_time = function(){
        var now = new Date();
        var created_time = new Date($("#date_set").val());
        if(now.valueOf()>=created_time.valueOf()){
            return true;
        }
        return true;//return false;
    };
    var limittime =  function(){
        var start = (new Date($("input[name='timelimit_begin']").val())).getTime();
        var end = (new Date($("input[name='timelimit_end']").val())).getTime();
        if(end != 0 && start > end) {
            return false;
        }
        return true;
    };

    function getNowFormatDate(date) {
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + date.getHours() + seperator2 + date.getMinutes();
        return currentdate;
    }
    <?php if(!$editAction || empty($model->created_at)): ?>
    $('#date_set').val('<?= date("Y-m-d H:i:s") ?>');
    <?php else: ?>
    $('#date_set').val('<?= date("Y-m-d H:i:s",$model->created_at) ?>');
    <?php endif; ?>

    //如果是新增文章则给时效设置一个初始值
    var isAdd = <?=isset($model->timelimit_begin)? 0 : 1?>;
    if(isAdd == 1){
        var today = new Date();
        var tomorrow = new Date();
        tomorrow.setSeconds(today.getSeconds()+86400);
        $('#time_end').val('<?= date("Y-m-d H:i", time()+86400) ?>');
    }
    if( $('#toggle-time').attr("checked") ){
        $(".time_model").show();
    }
</script>