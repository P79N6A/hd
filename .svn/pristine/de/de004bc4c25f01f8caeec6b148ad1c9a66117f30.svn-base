<?php
$this->partial("partials/breadcrumb", [
    'urls' => ['抽奖会场列表' => Url::get('lottery_channels/index?group_id='.Request::get('group_id'))],
    'add' => Url::get('lottery_channels/add?group_id='.Request::get('group_id')),
    'html' => '',
]);
?>
<div class="table-info table-responsive sortable ui-sortable" id="sorttable">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th class="table-checkbox">选择</th>
                <th>会场名称</th>
                <th>会场背景图</th>
                <th>Logo</th>
                <th>创建时间</th>
                <th>更新时间</th>
                <th>频道类型</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <?php
            if (!empty($data->models)) {
                foreach ($data->models as $v) {
                    ?>
                    <tr>
                        <td class="checkbox-middle">
                            <input type="checkbox" class="checkboxes" value="1"/>
                        </td>
                        <td><?= $v->name ?></td>
                        <td>
                            <?php
                            $img_extension = substr($v->background, strrpos($v->background, '.')+1);
                            if(in_array($img_extension, array("jpg","png","jpeg","gif"))) {
                                ?>
                            <img class="small-img" src="<?= $v->background ? cdn_url('image',$v->background):''?>"/>
                                <?php
                            }
                            ?>
                        </td>
                        <td>
                            <?php
                            $img_extension = substr($v->style, strrpos($v->style, '.')+1);
                            if(in_array($img_extension, array("jpg","png","jpeg","gif"))) {
                                ?>
                            <img class="small-img" src="<?= $v->style ? cdn_url('image',$v->style):''?>"/>
                                <?php
                            }
                            ?>

                        </td>
                        <td><?= date('Y-m-d H:i:s', $v->created_at) ?></td>
                        <td><?= date('Y-m-d H:i:s', $v->updated_at) ?></td>
                        <td><?= $v->type=='tv' ? '电视台':'广播台'; ?></td>
                        <td>
                            <div class="btn-group btn-group-xs btn-group-solid">
                                <button type="button" class="btn green edit-content tooltips" data-url="<?= Url::get('lottery_channels/edit', ['id' => $v->id , 'group_id' => $v->group_id]) ?>" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="编辑"><i class="fa fa-edit"></i></button>
                                <button type="button" class="btn red tooltips" data-url= "<?= Url::get('lottery_channels/delete', ['id' => $v->id]) ?>" onclick="show_confirm(this)"  data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="删除"><i class="fa fa-trash-o"></i></button>
                                <a class="btn green tooltips" href="<?= Url::get('lotteries/index', ['id' => $v->id , 'group_id' => $v->group_id]) ?>" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="管理场次"><i class="fa fa-edit"></i></a>
                                <a class="btn yellow tooltips" href="<?= Url::get('lottery_prizes/index', ['belong_to' => $v->id , 'type'=> 'lottery_channel' , 'group_id' => $v->group_id]) ?>" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="管理奖品"><i class="fa fa-gift"></i></a>
                            </div>
                        </td>
                    </tr>
                    <?php
                }
            }
            ?>
        </tbody>
    </table>

    <div class="paginationnav">
        <div class="paginationnav-main">
            <?= $data->pagination->render(); ?>
            <div class="pagination-info"><?= Lang::_('total') . "： " . $data->count ?></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $("#sorttable .table").tablesorter({
        headers:{
            0:{sorter:false},
            2:{sorter:false},
            7:{sorter:false}
        }
    });
</script>