<?php
Input::init(Request::getPost(), $model);
?>
<div class="form page-quick-sidebar-form">
    <!-- BEGIN FORM-->
    <form action="" method="post" class="form-horizontal form-bordered form-label-stripped form-stations" enctype="multipart/form-data">
        <div class="page-quick-sidebar-title">
            <span class="page-quick-sidebar-titleinfo font-blue"><i class="fa fa-info"></i><?= $action ?>&nbsp;<?= Input::fetch('name') ?></span>
            <div class="btn-group">
                <button type="submit" class="btn blue"><i class="fa fa-check"></i> 提交</button>
            </div>
        </div>

        <div class="form-body">
            <?php $this->partial('partials/error_messages');?>
            <div class="form-group">
                <label class="control-label col-md-2">参数名 <span class="font-red">*必填</span></label>
                <div class="col-md-10">
                    <input name="param_label" type="text" placeholder="参数名 例：年龄" value="<?= Input::fetch('param_label') ?>" maxlength="20" class="form-control input-large maxlength-handler validate-box"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">参数存储名 <span class="font-red">*必填</span></label>
                <div class="col-md-10">
                    <input name="param_name" type="text" placeholder="参数存储名 例：age" value="<?= Input::fetch('param_name') ?>" maxlength="20" class="form-control input-large maxlength-handler validate-box"/>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2">表单类型</label>
                <div class="col-md-10">
                    <select name="param_fun_type" id="param_fun_type" class="form-control input-large validate-box select2_category" data-placeholder="请选择">
                        <?php
                        if (!empty($listfuntype)) {
                            foreach ($listfuntype as $k => $v) {
                                ?>
                                <option value="<?= $k ?>" <?php if(Input::fetch('param_fun_type')==$k){ ?>selected<?php } ?> ><?= $v ?></option>
                                <?php
                            }
                        }
                        ?>
                    </select>
                    <span id="Warning" name="Warning" class="font-red"></span>
                </div>
            </div>


            <div class="form-group" id="advert-style">
                <label class="control-label col-md-2">选项值</label>
                <div class="col-md-10">

                    <input name="param_data_setting[]" type="text"  placeholder="选项值(可为空)" value="" class="form-control input-large validate-box"/>
                    <input name="param_data_value[]" type="text" placeholder="选项值(空值将被忽略)" value="" class="form-control input-large validate-box"/>

                    <button type="button" class="btn blue add-style"><i class="fa fa-plus"></i> 添加选项值</button>

                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2">默认值 <span class="font-red">*必填</span></label>
                <div class="col-md-10">
                    <input name="param_default" type="text" placeholder="默认值" value="<?= Input::fetch('param_default') ?>" maxlength="20" class="form-control input-large maxlength-handler validate-box"/>
                </div>
            </div>

            <div class="form-group" >
                <label class="control-label col-md-2">验证方式 <?php echo $validatetype;?></label>
                <div class="col-md-10">
                    <select name="param_validate" id="param_validate" class="form-control input-large validate-box select2_category" data-placeholder="请选择">
                        <option value="none">无</option>
                        <?php
                        if (!empty($listvalidatetypes)) {
                            foreach ($listvalidatetypes as $k => $v) {
                                ?>
                                <option value="<?= $k ?>"  <?php if($validatetype==$k){ ?>selected<?php } ?>  ><?= $v ?></option>
                                <?php
                            }
                        }
                        ?>
                    </select>
                    <span id="Warning" name="Warning" class="font-red"></span>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">允许最小长度 <span class="font-red">*必填</span></label>
                <div class="col-md-10">
                    <input name="minlength" type="text" value="<?= $minlength ?>" maxlength="20" class="form-control input-large maxlength-handler validate-box"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">允许最大长度 <span class="font-red">*必填</span></label>
                <div class="col-md-10">
                    <input name="maxlength" type="text" value="<?= $maxlength ?>" maxlength="20" class="form-control input-large maxlength-handler validate-box"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">备注</label>
                <div class="col-md-10">
                    <textarea placeholder="备注" rows="3" maxlength="200" class="form-control maxlength-handler" name="param_remark"><?=Input::fetch('param_remark')?></textarea>
                </div>
            </div>

        </div>
</div>
    </form>
    <!-- END FORM-->
</div>
<script type="text/javascript">
    // form stations
    $('.form-stations').validate({
        errorElement: 'span', //default input error message container
        errorClass: 'help-block', // default input error message class
        focusInvalid: true, // do not focus the last invalid input
        rules: {
            name: {
                required: true
            }
        },
        messages: {
            name: {
                required: '名称不能为空'
            }
        },

        invalidHandler: function(event, validator) {
            //$('.alert-danger', $('.login-form')).show();
        },

        highlight: function(element) { // hightlight error inputs
            $(element)
                .closest('.form-group').addClass('has-error'); // set error class to the control group
        },

        success: function(label) {
            label.closest('.form-group').removeClass('has-error');
            label.remove();
        },

        errorPlacement: function(error, element) {
            error.insertAfter(element.closest('.validate-box'));
        },

        submitHandler: function(form) {
            form.submit(); // form validation success, call ajax form submit
            //parent.location.reload(); //Refresh Iframe parent
        }

    });


    $(function() {
        var num = 1;
        function add_option(k, v) {
            k = k == undefined? '': k;
            v = v == undefined? '': v;
            $("#advert-style").append(
                '<div class="col-md-10 col-md-offset-2 col-md-adjust">' +
                '<input name="param_data_setting[]" type="text" placeholder="选项值(可为空)" value="'+k+'" class="form-control input-large validate-box" />' +
                '<input name="param_data_value[]" type="text" placeholder="选项值(空值将被忽略)" value="'+v+'" class="form-control input-large validate-box" />' +
                '<a class="btn red remove-style-'+num+'"><i class="fa fa-remove"></i></a>' +
                '</div>'
            );
            $(".remove-style-"+num).click(function() {
                $(this).parent().remove();
            });
            num++;
        }
        <?php foreach($param_datas as $key => $value) { ?>
        add_option('<?= $key;?>', '<?= $value; ?>');
        <?php } ?>
        $('.add-style').click(function() {
            add_option();
        });
    });



</script>