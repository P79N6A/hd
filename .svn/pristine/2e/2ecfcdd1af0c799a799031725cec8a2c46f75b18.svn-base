<?php
$this->partial("partials/breadcrumb", [
    'urls' => [$name=>Url::get('specials/index'),'媒资列表' => Url::get('specials/mediaindex?id='.$special_id)],
    'add'=> Url::get(""),
    'html' => '',
]);
?>
<div class="table-info table-responsive sortable ui-sortable" id="sorttable">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th class="table-checkbox">选择</th>
                <th>标题</th>
                <th>专题栏目</th>
                <th>修改时间</th>
                <th>编辑</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach($parcel->models as $model): ?>
            <tr>
                <td class="checkbox-middle">
                    <input type="checkbox" class="checkboxes" value="<?= $model->data->id?>"/>
                </td>
                <td>
                    <img class="small-img" src="<?= $model->data->thumb? (cdn_url('image',$model->data->thumb)): '/assets/admin/layout/cztv_img/defaultlogo.png'; ?>"/>
                    <span class="name-center">
                        <?= $model->data->title;?>
                    </span>
                </td>
                <td><?= $model->specialCategory->name;?></td>
                <td><?php echo date('Y-m-d',$model->data->updated_at)?></td>
                <td><?= $model->data->author_name;?></td>
                <td><span class="<?= $model->data->status == 1 ? '': ($model->data->status == 9 ? 'font-red' : 'font-red-haze') ?>"><?= $model->data->status == 1 ? '已经发布': ($model->data->status == 9 ? '待审核' : '未发布') ?></span></td>
                <td>
                    <div class="btn-group btn-group-xs btn-group-solid">
                        <!-- <button type="button" class="btn purple tooltips" value="" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="预览"><i class="fa fa-eye"></i></button> -->
                        <?php
                        switch( $model->data->type) {
                            case 'news':
                                $edit_pre = 'media_posts';
                                break;
                            case 'album':
                                $edit_pre = 'media_albums';
                                break;
                            case 'video':
                                $edit_pre = 'media_video';
                                break;
                            default:
                                throw new \Phalcon\Exception('Invalid media type');
                        }
                        $edit_url = Url::get($edit_pre.'/edit', ['id' => $model->data->source_id]);
                        ?>
                        <?php if($edit_pre!='media_video') :?>
                        <button type="button" class="btn green edit-content tooltips" data-url="<?= $edit_url ;?>" data-container="body" data-placement="top" data-trigger="hover" data-html="true" data-original-title="编辑"><i class="fa fa-edit"></i></button>

                        <?php if($checkAuth('publish/approve')){ ?>
                            <button type="button" class="btn tooltips <?= $model->data->status == 9 ? 'blue': 'red' ?>"
                                    data-url="<?= Url::get('publish/approve', ['id' => $model->data->id]); ?>"
                                    data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                    data-original-title="<?= $model->data->status == 9 ? '审查': '取消审查' ?>" onclick="show_confirm(this)"><i
                                    class="fa  <?= $model->data->status == 9 ? 'fa-check': 'fa-ban' ?>"></i></button>
                        <?php }?>

                        <?php if($checkAuth('media_posts/publish')){ ?>
                            <button type="button" class="btn green-jungle edit-content tooltips"
                                    data-url="<?= Url::get('media_posts/publish', ['id' => $model->data->id]); ?>"
                                    data-container="body" data-placement="top" data-trigger="hover" data-html="true"
                                    data-original-title="<?= $model->data->status == 1 ? '修改发布栏目': ($model->data->status == 9 ? '修改发布栏目' : '发布') ?>"><i class="fa <?= $model->data->status == 1 ? 'fa-pencil': ($model->data->status == 9 ? 'fa-pencil' : 'fa-send') ?>"></i></button>
                        <?php }?>

                        <?php endif?>
                    </div>
                </td>
            </tr>
        <?php endforeach ?>
        <?php if(count($parcel->models) == 0) { ?>
            <tr class="sortable-tr"><td colspan="11">未能找到相关数据</td></tr>
        <?php } ?>
        <?php ?>
        </tbody>
    </table>

    <div class="paginationnav">
        <div class="paginationnav-main">
            <div class="table-btn">
                <div class="btn-group">
                    <button type="button" class="btn btn-default group-checkable" data-set="#sorttable .checkboxes">全选</button>
                    <button type="button" class="btn btn-default group-offcheckable" data-set="#sorttable .checkboxes">取消</button>
                    <button type="button" class="btn btn-default group-anticheckable" data-set="#sorttable .checkboxes">反选</button>
                </div>
            </div>
            <?= $parcel->pagination->render(); ?>
            <div class="pagination-info">总计 <?= $parcel->count ?> 条</div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $("#sorttable .table").tablesorter({
        headers:{
            0:{sorter:false},
            6:{sorter:false}
        }
    });
</script>